/**
 * Suggestions-jquery plugin, version 4.2.3
 *
 * Suggestions-jquery plugin is freely distributable under the terms of MIT-style license
 * Built on Ajax Autocomplete for jQuery (https://github.com/devbridge/jQuery-Autocomplete)
 * For details, see https://github.com/hflabs/suggestions-jquery
 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function b(c,d){var e=function(){},f=this,g={autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:b.formatResult,delimiter:null,zIndex:9999,noCache:!1,onSearchStart:e,onSearchComplete:e,onSearchError:e,containerClass:"autocomplete-suggestions",tabDisabled:!1,currentRequest:null,triggerSelectOnValidInput:!1,triggerSelectOnSpace:!0,preventBadQueries:!0,lookupFilter:function(a,b,c){return-1!==a.value.toLowerCase().indexOf(c)},paramName:"query",transformResult:function(b){return"string"==typeof b?a.parseJSON(b):b}};f.element=c,f.el=a(c),f.suggestions=[],f.badQueries=[],f.selectedIndex=-1,f.currentValue=f.element.value,f.intervalId=0,f.cachedResponse={},f.onChangeInterval=null,f.onChange=null,f.isLocal=!1,f.suggestionsContainer=null,f.options=a.extend({},g,d),f.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},f.hint=null,f.hintValue="",f.selection=null,f.$viewport=a(window),f.triggeredSelectOnSpace=!1,f.skipOnFocus=!1,f.initialize(),f.setOptions(d)}var c=function(){return{escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(a){var b=document.createElement("div");return b.className=a,b.style.position="absolute",b.style.display="none",b},getDefaultType:function(){return a.support.cors?"POST":"GET"},getDefaultContentType:function(){return a.support.cors?"application/json":"application/x-www-form-urlencoded"},serialize:function(b){return a.support.cors?JSON.stringify(b):a.param(b,!0)}}}(),d={ESC:27,TAB:9,RETURN:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40},e=".suggestions",f="suggestions",g={};b.utils=c,a.Suggestions=b,b.formatResult=function(a,b){var d="(^|\\s+)("+c.escapeRegExChars(b)+")";return a.value.replace(new RegExp(d,"gi"),"$1<strong>$2</strong>")},b.prototype={initialize:function(){var c,d=this,f="."+d.classes.suggestion,g=d.classes.selected,h=d.options;d.element.setAttribute("autocomplete","off"),d.suggestionsContainer=b.utils.createNode(h.containerClass),c=a(d.suggestionsContainer),c.appendTo(h.appendTo),"auto"!==h.width&&c.width(h.width),c.on("mousedown"+e,f,function(b){b.preventDefault(),d.cancelBlur=!0,d._delay(function(){delete d.cancelBlur}),a(b.target).closest(".ui-menu-item").length||d._delay(function(){a(document).one("mousedown",function(b){b.target===d.element||b.target===d.suggestionsContainer||a.contains(d.suggestionsContainer,b.target)||d.hide()})})}),c.on("mouseover"+e,f,function(){d.activate(a(this).data("index"))}),c.on("mouseout"+e,function(){d.selectedIndex=-1,c.children("."+g).removeClass(g)}),c.on("click"+e,f,function(){d.select(a(this).data("index")),d.skipOnFocus=!0,d.el.focus()}),d.fixPosition(),d.fixPositionCapture=function(){d.visible&&d.fixPosition()},d.$viewport.on("resize"+e,d.fixPositionCapture),d.el.on("keydown"+e,function(a){d.onKeyPress(a)}),d.el.on("keyup"+e,function(a){d.onKeyUp(a)}),d.el.on("blur"+e,function(){d.onBlur()}),d.el.on("focus"+e,function(){d.onFocus()}),d.el.on("change"+e,function(a){d.onKeyUp(a)})},onFocus:function(){var a=this;a.skipOnFocus||(a.fixPosition(),a.options.minChars<=a.el.val().length&&a.onValueChange()),a.skipOnFocus=!1},onBlur:function(){var a=this;return a.cancelBlur?void delete a.cancelBlur:(a.selectCurrentValue(),void a.hide())},setOptions:function(b){var c=this,d=c.options;a.extend(d,b),c.isLocal=a.isArray(d.lookup),c.isLocal&&(d.lookup=c.verifySuggestionsFormat(d.lookup)),a(c.suggestionsContainer).css({"max-height":d.maxHeight+"px",width:d.width+"px","z-index":d.zIndex}),c.checkToken()},getAjaxParams:function(){var b,d=this,e=a.trim(d.options.token);return b={type:c.getDefaultType(),dataType:"json",contentType:c.getDefaultContentType()},e&&(b.headers={Authorization:"Token "+e}),b},checkToken:function(){var b,c=this,d=a.trim(c.options.token),e=g[d],f=function(){c.checkToken()};if(d)if(e&&a.isFunction(e.promise))switch(e.state()){case"resolved":c.enable();break;case"rejected":c.disable();break;default:e.then(f)}else b=c.options.serviceUrl,a.isFunction(b)&&(b=b.call(c.element)),g[d]=a.ajax(a.extend(c.getAjaxParams(),{url:b})).then(f)},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var a=this;a.disabled=!0,a.currentRequest&&a.currentRequest.abort()},enable:function(){this.disabled=!1},fixPosition:function(){var b,c,d,e=this;"body"===e.options.appendTo&&(b=e.el.offset(),b.bottom=b.top+e.el.outerHeight(),d=a(e.suggestionsContainer),c={top:b.bottom+"px",left:b.left+"px"},"auto"===e.options.width&&(c.width=e.el.outerWidth()-2+"px"),d.css(c))},isCursorAtEnd:function(){var a,b=this,c=b.el.val().length,d=b.element.selectionStart;return"number"==typeof d?d===c:document.selection?(a=document.selection.createRange(),a.moveStart("character",-c),c===a.text.length):!0},onKeyPress:function(a){var b,c=this;if(c.triggeredSelectOnSpace=!1,!c.disabled&&!c.visible&&a.which===d.DOWN&&c.currentValue)return void c.suggest();if(!c.disabled&&c.visible){switch(a.which){case d.ESC:c.el.val(c.currentValue),c.hide();break;case d.RIGHT:if(c.hint&&c.options.onHint&&c.isCursorAtEnd()){c.selectHint();break}return;case d.TAB:if(c.hint&&c.options.onHint)return void c.selectHint();if(-1===c.selectedIndex)return void c.hide();if(c.select(c.selectedIndex),c.options.tabDisabled===!1)return;break;case d.RETURN:if(b=c.selectCurrentValue(),-1===b)return void c.hide();break;case d.SPACE:return void(c.options.triggerSelectOnSpace&&(b=c.selectCurrentValue(),-1!==b&&(c.triggeredSelectOnSpace=!0)));case d.UP:c.moveUp();break;case d.DOWN:c.moveDown();break;default:return}a.stopImmediatePropagation(),a.preventDefault()}},onKeyUp:function(a){var b=this;if(!b.disabled){switch(a.which){case d.UP:case d.DOWN:return}clearInterval(b.onChangeInterval),b.currentValue!==b.el.val()&&(b.findBestHint(),b.options.deferRequestBy>0?b.onChangeInterval=setInterval(function(){b.onValueChange()},b.options.deferRequestBy):b.onValueChange())}},onValueChange:function(){var b,c=this,d=c.options,e=c.el.val(),f=c.getQuery(e);return c.selection&&(c.selection=null,(d.onInvalidateSelection||a.noop).call(c.element)),clearInterval(c.onChangeInterval),c.currentValue=e,c.selectedIndex=-1,d.triggerSelectOnValidInput&&(b=c.findSuggestionIndex(f),-1!==b)?void c.select(b):void(f.length<d.minChars?c.hide():c.getSuggestions(f))},findSuggestionIndex:function(b){var c=this,d=-1,e=b.toLowerCase();return a.each(c.suggestions,function(a,b){return b.value.toLowerCase()===e?(d=a,!1):void 0}),d},getQuery:function(b){var c,d=this.options.delimiter;return d?(c=b.split(d),a.trim(c[c.length-1])):b},getSuggestionsLocal:function(b){var c,d=this,e=d.options,f=b.toLowerCase(),g=e.lookupFilter,h=parseInt(e.lookupLimit,10);return c={suggestions:a.grep(e.lookup,function(a){return g(a,b,f)})},h&&c.suggestions.length>h&&(c.suggestions=c.suggestions.slice(0,h)),c},getSuggestions:function(b){var d,e,f,g=this,h=g.options,i=h.serviceUrl;if(h.params[h.paramName]=b,e=h.ignoreParams?null:h.params,g.isLocal?d=g.getSuggestionsLocal(b):(a.isFunction(i)&&(i=i.call(g.element,b)),f=i+"?"+a.param(e||{}),d=g.cachedResponse[f]),d&&a.isArray(d.suggestions))g.suggestions=d.suggestions,g.suggest();else if(!g.isBadQuery(b)){if(h.onSearchStart.call(g.element,h.params)===!1)return;g.currentRequest&&g.currentRequest.abort(),g.currentRequest=a.ajax(a.extend(g.getAjaxParams(),{url:i,data:c.serialize(e)})).done(function(a){var c;g.currentRequest=null,c=h.transformResult(a),g.processResponse(c,b,f),h.onSearchComplete.call(g.element,b,c.suggestions)}).fail(function(a,c,d){h.onSearchError.call(g.element,b,a,c,d)})}},isBadQuery:function(a){if(!this.options.preventBadQueries)return!1;for(var b=this.badQueries,c=b.length;c--;)if(0===a.indexOf(b[c]))return!0;return!1},hide:function(){var b=this;b.visible=!1,b.selectedIndex=-1,a(b.suggestionsContainer).hide(),b.signalHint(null)},suggest:function(){if(0===this.suggestions.length)return void this.hide();var b,c,d=this,e=d.options,f=e.formatResult,g=d.getQuery(d.currentValue),h=d.classes.suggestion,i=d.classes.selected,j=a(d.suggestionsContainer),k=e.beforeRender,l="";return e.triggerSelectOnValidInput&&(b=d.findSuggestionIndex(g),-1!==b)?void d.select(b):(e.triggerSelectOnSpace&&!d.triggeredSelectOnSpace&&/\s$/.test(g)&&(b=d.findSuggestionIndex(g.replace(/\s$/,"")),-1!==b&&d.onSelect(b)),a.each(d.suggestions,function(a,b){l+='<div class="'+h+'" data-index="'+a+'">'+f(b,g)+"</div>"}),"auto"===e.width&&(c=d.el.outerWidth()-2,j.width(c>0?c:300)),j.html(l),e.autoSelectFirst&&(d.selectedIndex=0,j.children().first().addClass(i)),a.isFunction(k)&&k.call(d.element,j),j.show(),d.visible=!0,void d.findBestHint())},findBestHint:function(){var b=this,c=b.el.val().toLowerCase(),d=null;c&&(a.each(b.suggestions,function(a,b){var e=0===b.value.toLowerCase().indexOf(c);return e&&(d=b),!e}),b.signalHint(d))},signalHint:function(b){var c="",d=this;b&&(c=d.currentValue+b.value.substr(d.currentValue.length)),d.hintValue!==c&&(d.hintValue=c,d.hint=b,(this.options.onHint||a.noop)(c))},verifySuggestionsFormat:function(b){return b.length&&"string"==typeof b[0]?a.map(b,function(a){return{value:a,data:null}}):b},processResponse:function(a,b,c){var d=this,e=d.options;a.suggestions=d.verifySuggestionsFormat(a.suggestions),e.noCache||(d.cachedResponse[c]=a,e.preventBadQueries&&0===a.suggestions.length&&d.badQueries.push(b)),b===d.getQuery(d.currentValue)&&(d.suggestions=a.suggestions,d.suggest())},activate:function(b){var c,d=this,e=d.classes.selected,f=a(d.suggestionsContainer),g=f.children();return f.children("."+e).removeClass(e),d.selectedIndex=b,-1!==d.selectedIndex&&g.length>d.selectedIndex?(c=g.get(d.selectedIndex),a(c).addClass(e),c):null},selectHint:function(){var b=this,c=a.inArray(b.hint,b.suggestions);b.select(c)},selectCurrentValue:function(){var a=this,b=a.selectedIndex;if(-1===b){var c=a.getQuery(a.el.val());b=a.findSuggestionIndex(c)}return-1!==b&&a.select(b),b},select:function(a,b){var c=this,d=c.suggestions[a];c.currentValue=c.getValue(d.value),c.el.val(c.currentValue),c.signalHint(null),c.selection=d,b||c.hide(),c.onSelect(a),c.suggestions=[]},unselect:function(){var b=this;a(b.suggestionsContainer).children().removeClass(b.classes.selected),b.selectedIndex=-1,b.el.val(b.currentValue),b.findBestHint()},moveUp:function(){var a=this;return-1===a.selectedIndex?void(a.suggestions.length&&a.adjustScroll(a.suggestions.length-1)):0===a.selectedIndex?void a.unselect():void a.adjustScroll(a.selectedIndex-1)},moveDown:function(){var a=this;return a.selectedIndex===a.suggestions.length-1?void a.unselect():void a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(b){var c,d,e,f=this,g=f.activate(b),h=25;g&&(c=g.offsetTop,d=a(f.suggestionsContainer).scrollTop(),e=d+f.options.maxHeight-h,d>c?a(f.suggestionsContainer).scrollTop(c):c>e&&a(f.suggestionsContainer).scrollTop(c-f.options.maxHeight+h),f.el.val(f.getValue(f.suggestions[b].value)),f.signalHint(null))},onSelect:function(b){var c=this,d=c.options.onSelect,e=c.suggestions[b];a.isFunction(d)&&d.call(c.element,e)},getValue:function(a){var b,c,d=this,e=d.options.delimiter;return e?(b=d.currentValue,c=b.split(e),1===c.length?a:b.substr(0,b.length-c[c.length-1].length)+a):a},dispose:function(){var b=this;b.el.off(e).removeData(f),b.$viewport.off("resize"+e),a(b.suggestionsContainer).remove()},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)}},a.fn.suggestions=function(c,d){return 0===arguments.length?this.first().data(f):this.each(function(){var e=a(this),g=e.data(f);"string"==typeof c?g&&"function"==typeof g[c]&&g[c](d):(g&&g.dispose&&g.dispose(),g=new b(this,c),e.data(f,g))})}});